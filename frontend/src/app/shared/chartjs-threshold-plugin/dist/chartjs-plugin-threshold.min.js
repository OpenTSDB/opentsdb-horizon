/**
 * This file is part of OpenTSDB.
 * Copyright (C) 2021  Yahoo.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!(function () {
    function e(t, o, s) {
        function r(h, l) {
            if (!o[h]) {
                if (!t[h]) {
                    var i = "function" == typeof require && require;
                    if (!l && i) return i(h, !0);
                    if (n) return n(h, !0);
                    var d = new Error("Cannot find module '" + h + "'");
                    throw ((d.code = "MODULE_NOT_FOUND"), d);
                }
                var a = (o[h] = { exports: {} });
                t[h][0].call(
                    a.exports,
                    function (e) {
                        var o = t[h][1][e];
                        return r(o || e);
                    },
                    a,
                    a.exports,
                    e,
                    t,
                    o,
                    s
                );
            }
            return o[h].exports;
        }
        for (
            var n = "function" == typeof require && require, h = 0;
            h < s.length;
            h++
        )
            r(s[h]);
        return r;
    }
    return e;
})()(
    {
        1: [function (e, t, o) {}, {}],
        2: [
            function (e, t, o) {
                function s(e, t) {
                    (this.id = t.id),
                        (this.value = t.value),
                        (this.scaleId = t.scaleId),
                        (this.chart = e),
                        (this.options = t),
                        this.update();
                }
                (s.prototype.update = function () {
                    var e = this.chart,
                        t = this.options.borderWidth || 1,
                        o = t % 2 == 1 ? 0.5 : 0;
                    (this.x1 = Math.round(e.chartArea.left)),
                        (this.y1 =
                            e.scales[this.scaleId].getPixelForValue(
                                this.value
                            ) + o),
                        (this.x2 =
                            this.x1 +
                            Math.round(e.chartArea.right - e.chartArea.left)),
                        (this.y2 = this.y1);
                }),
                    (s.prototype.setBorder = function (e) {
                        this.border = e;
                    }),
                    (s.prototype.draw = function (e) {
                        e.beginPath(),
                            e.setLineDash &&
                                e.setLineDash(this.options.borderDash || []);
                        var t = this.options.borderWidth || 1;
                        (e.lineWidth = t),
                            (e.strokeStyle =
                                this.options.borderColor || "#000000"),
                            (e.lineDashOffset =
                                this.options.borderDashOffset || 0),
                            e.moveTo(this.x1, this.y1),
                            e.lineTo(this.x2, this.y2),
                            e.stroke(),
                            e.closePath();
                        var o = this.options.borderWidth || 1,
                            s = 5;
                        this.border &&
                            (e.beginPath(),
                            (e.strokeStyle = "rgba(0,0,0,1)"),
                            (e.lineWidth = 2),
                            e.setLineDash([4, 2]),
                            e.strokeRect(
                                this.x1,
                                this.y1 - (s + o),
                                this.x2 - this.x1,
                                2 * (o + s)
                            ),
                            e.closePath(),
                            e.restore());
                    }),
                    (s.prototype.inRange = function (e, t, o) {
                        return (
                            this.x1 <= e &&
                            this.x2 >= e &&
                            this.y1 - o <= t &&
                            this.y1 + o >= t
                        );
                    }),
                    (t.exports = s);
            },
            {},
        ],
        3: [
            function (e, t, o) {
                var s = e("chart.js");
                (s = "function" == typeof s ? s : window.Chart),
                    (s.Threshold = s.Threshold || {}),
                    (s.Threshold.defaults = {
                        draw: !1,
                        maxLines: Number.MAX_VALUE,
                        scaleId: "y-axis-0",
                        thresholds: [],
                    }),
                    (s.Threshold.lineDefaults = {
                        borderColor: "#000000",
                        borderWidth: 1,
                        borderDash: [],
                        borderDashOffset: 0,
                    });
                var r = e("./threshold.js")(s);
                (t.exports = r), s.pluginService.register(r);
            },
            { "./threshold.js": 4, "chart.js": 1 },
        ],
        4: [
            function (e, t, o) {
                "use strict";
                var s = e("./element.thresholdline.js");
                t.exports = function (e) {
                    function t(t) {
                        var s = t.ctx.canvas,
                            r = document.createElement("canvas"),
                            n = s.parentNode;
                        n.appendChild(r),
                            (r.style.position = "absolute"),
                            (r.style.left = "0px"),
                            (r.style.top = "0px"),
                            (r.style.zIndex = 1),
                            h(r, "pointer"),
                            (t.options.threshold = c.configMerge(
                                e.Threshold.defaults,
                                t.options.threshold || {}
                            )),
                            console.log(
                                t.options.threshold,
                                "instance options.."
                            ),
                            (t.threshold = {
                                elements: {},
                                overlayCanvas: r,
                                firstRun: !1,
                                selection: null
                            }),
                            o(t);
                    }
                    function o(e) {
                        var t = e.currentDevicePixelRatio || 1;
                        (e.threshold.overlayCanvas.width = e.width * t),
                            (e.threshold.overlayCanvas.height = e.height * t),
                            e.threshold.overlayCanvas
                                .getContext("2d")
                                .scale(t, t),
                            (e.threshold.overlayCanvas.style.height =
                                e.height + "px"),
                            (e.threshold.overlayCanvas.style.width =
                                e.width + "px");
                    }
                    function r(t) {
                        (t.options.threshold = c.configMerge(
                            e.Threshold.defaults,
                            t.options.threshold || {}
                        )),
                            (a =
                                t.options.threshold && t.options.threshold.line
                                    ? c.configMerge(
                                          e.Threshold.lineDefaults,
                                          t.options.threshold.line
                                      )
                                    : e.Threshold.lineDefaults),
                            (t.threshold.overlayCanvas.style.display = t.options
                                .threshold.draw
                                ? "block"
                                : "none"),
                            (t.threshold.selection = null),
                            (t.threshold.firstRun = !1);
                    }
                    function n(e) {
                        var t = e.options.threshold.draw
                                ? e.threshold.overlayCanvas.getContext("2d")
                                : e.ctx,
                            o = e.threshold.elements;
                        e.options.threshold.draw &&
                            t.clearRect(0, 0, t.canvas.width, t.canvas.height);
                        for (var s in o) o[s].draw(t);
                    }
                    function h(e, t) {
                        e.style.cursor = t;
                    }
                    function l(e, t) {
                        i(e),
                            (e.threshold.selection = t),
                            e.threshold.selection.setBorder(1),
                            (v = !0),
                            c.addEvent(
                                document,
                                "keydown",
                                e.threshold._winKeyDownEventHandler
                            );
                    }
                    function i(e) {
                        e.threshold.selection &&
                            e.threshold.selection.setBorder(0),
                            (e.threshold.selection = null),
                            (v = !1),
                            c.removeEvent(
                                document,
                                "keydown",
                                e.threshold._winKeyDownEventHandler
                            );
                    }
                    function d(e) {
                        console.log("send events..", e.threshold.elements);
                        var t = new CustomEvent("onThresholdSet", {
                            detail: e.threshold.elements,
                        });
                        e.ctx.canvas.dispatchEvent(t);
                    }
                    var a,
                        c = e.helpers,
                        v = !1,
                        u = 2;
                    return {
                        id: "threshold",
                        afterInit: function (o) {
                            t(o),
                                (o.threshold._winKeyDownEventHandler =
                                    function (e) {
                                        o.threshold.selection &&
                                            8 == e.keyCode &&
                                            (console.log(
                                                o,
                                                "coimes ......",
                                                o.threshold.selection,
                                                o.threshold.elements
                                            ),
                                            delete o.threshold.elements[
                                                o.threshold.selection.id
                                            ],
                                            i(o),
                                            console.log(o.threshold.elements),
                                            n(o));
                                    }),
                                (o.threshold._mouseDownEventHandler = function (
                                    t
                                ) {
                                    console.log("mouse down..");
                                    var r = t.offsetX,
                                        h = t.offsetY;
                                    for (var a in o.threshold.elements)
                                        if (
                                            o.threshold.elements[a].inRange(
                                                r,
                                                h,
                                                u
                                            )
                                        )
                                            return (
                                                l(o, o.threshold.elements[a]),
                                                void n(o)
                                            );
                                    if (o.options.threshold.draw) {
                                        if (o.threshold.selection) i(o);
                                        else if (
                                            Object.keys(o.threshold.elements)
                                                .length <
                                            o.options.threshold.maxLines
                                        ) {
                                            var v =
                                                    "line-" +
                                                    new Date().getTime(),
                                                f = {
                                                    id: v,
                                                    scaleId:
                                                        o.options.threshold
                                                            .scaleId,
                                                    value: o.scales[
                                                        o.options.threshold
                                                            .scaleId
                                                    ].getValueForPixel(
                                                        t.offsetY
                                                    )
                                                };
                                            (o.threshold.elements[v] = new s(
                                                o,
                                                c.configMerge(
                                                    e.Threshold.lineDefaults,
                                                    f
                                                )
                                            )),
                                                d(o);
                                        }
                                        console.log(
                                            o.threshold.elements,
                                            "added.."
                                        ),
                                            n(o);
                                    }
                                }),
                                (o.threshold._mouseMoveEventHandler = function (
                                    e
                                ) {
                                    if (v)
                                        e.offsetY <= o.chartArea.bottom &&
                                            e.offsetY >= o.chartArea.top &&
                                            ((o.threshold.selection.value =
                                                o.scales[
                                                    o.threshold.selection
                                                        .scaleId
                                                ].getValueForPixel(e.offsetY)),
                                            o.threshold.selection.update(),
                                            n(o));
                                    else {
                                        var t = e.offsetX,
                                            s = e.offsetY;
                                        for (var r in o.threshold.elements)
                                            if (
                                                o.threshold.elements[r].inRange(
                                                    t,
                                                    s,
                                                    u
                                                )
                                            )
                                                return void h(
                                                    o.threshold.overlayCanvas,
                                                    "move"
                                                );
                                        h(o.threshold.overlayCanvas, "pointer");
                                    }
                                }),
                                (o.threshold._mouseUpEventHandler = function (
                                    e
                                ) {
                                    v && ((v = !1), d(o));
                                }),
                                c.addEvent(
                                    o.threshold.overlayCanvas,
                                    "mousedown",
                                    o.threshold._mouseDownEventHandler
                                ),
                                c.addEvent(
                                    o.threshold.overlayCanvas,
                                    "mousemove",
                                    o.threshold._mouseMoveEventHandler
                                ),
                                c.addEvent(
                                    o.threshold.overlayCanvas,
                                    "mouseup",
                                    o.threshold._mouseUpEventHandler
                                );
                        },
                        afterScaleUpdate: function (e) {
                            for (var t in e.threshold.elements)
                                e.threshold.elements[t].update();
                        },
                        afterUpdate: function (e) {
                            if (
                                (i(e),
                                r(e),
                                e.options.threshold &&
                                    e.options.threshold.thresholds &&
                                    !e.threshold.firstRun)
                            ) {
                                for (
                                    var t = e.options.threshold.thresholds,
                                        o =
                                            (e.chartArea.right -
                                                e.chartArea.left,
                                            0),
                                        n = t.length;
                                    o < n;
                                    o++
                                ) {
                                    var h =
                                        t[o].id ||
                                        "line-" + new Date().getTime();
                                    e.threshold.elements[h]
                                        ? (e.threshold.elements[h] = new s(
                                              e,
                                              c.configMerge(a, t[o])
                                          ))
                                        : ((t[o].id = h),
                                          (e.threshold.elements[h] = new s(
                                              e,
                                              c.configMerge(a, t[o])
                                          )));
                                }
                                e.threshold.firstRun = !0;
                            }
                        },
                        afterDraw: function (e) {
                            n(e);
                        },
                        resize: function (e) {
                            o(e);
                        },
                        destroy: function (e) {
                            c.removeEvent(
                                document,
                                "keydown",
                                e.threshold._winKeyDownEventHandler
                            ),
                            c.removeEvent(
                                e.threshold.overlayCanvas,
                                "mousedown",
                                e.threshold._mouseDownEventHandler
                            ),
                            c.removeEvent(
                                e.threshold.overlayCanvas,
                                "mousemove",
                                e.threshold._mouseMoveEventHandler
                            ),
                            c.removeEvent(
                                e.threshold.overlayCanvas,
                                "mouseup",
                                e.threshold._mouseUpEventHandler
                            ),
                            delete e.threshold;
                        },
                    };
                };
            },
            { "./element.thresholdline.js": 2 },
        ],
    },
    {},
    [3]
);
